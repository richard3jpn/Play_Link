# ⚾ 野球クラブ用 統合管理アプリ 最終仕様まとめ

## 1. プロジェクト概要
アマチュア野球チームの「広報活動（HP）」と「チーム内部運営（選手・スコア管理）」を一つのサービスで完結させる、オールインワンのWebアプリケーションを開発する。

## 2. 最終決定：技術スタック（A案）
開発のスピードと管理のシンプルさを最優先し、以下の構成を採用する。

* **フロントエンド:** React
* **バックエンド:** Node.js （Firebase Cloud Functions として実行）
* **データベース:** Firestore （Firebaseが提供するNoSQLデータベース）
* **デプロイ/管理:** Firebase CLI

## 3. 機能要件（全機能）

### ① 広報（HP）機能（一般公開エリア）
* **トップページ:** お知らせ、最新記事、次回の試合予定、最新の試合結果のサマリーを表示。
* **記事（ブログ）機能:**
    * 管理者が記事（テキスト・画像）を作成・編集・削除できる。
    * 記事作成時に、「試合結果」のデータを連携し、スコアボードを記事内に挿入できる。
* **試合結果（アーカイブ）:** 過去の試合結果（スコア、対戦相手）を一覧表示し、詳細（ボックススコア）も閲覧できる。
* **チーム紹介:** チームの理念や歴史などを掲載する静的なページ。
* **メンバー紹介:** 選手やスタッフの公開用プロフィール（写真、名前、ポジションなど）を表示。

### ② チーム運営（管理）機能（要ログインエリア）
* **ダッシュボード:** ログイン後のホーム画面。次の予定、お知らせなどを集約。
* **スケジュール管理:** 練習、試合、イベントの予定をカレンダー形式で登録・管理。
* **選手管理（選手名簿）:** 選手の詳細情報（背番号、ポジション、連絡先など）を登録・管理。
* **スコアブック（試合入力）機能:**
    * **スターティングメンバー登録:**
        * 試合前に、**全選手一覧**から選手を**ドラッグ＆ドロップ**で、**作戦ボード風のUI**（ポジション枠、ベンチ枠）に配置してスタメンと打順を決定する。
    * **一球ごとの入力:** 試合中、投球（ボール、ストライク等）や打撃結果（ヒット、アウト等）を直感的に入力する。
* **スコア・成績管理（自動集計）:**
    * 入力されたスコアを基に、個人成績（打率、防御率など）とチーム成績を**自動で集計**し、表示する。
    * 過去の試合のボックススコアを閲覧できる。
* **試合アーカイブ（動画管理）:** 試合記録に、YouTubeの限定公開URLなどの動画リンクを紐づけて管理できる。
* **チーム内連絡:** メンバーへのお知らせ一斉送信機能。

### ③ 共通・基盤機能
* **チーム管理:** チームのアカウントを作成し、基本情報（チーム名、ロゴ）を設定する。
* **認証機能:** メンバーの招待、アカウント登録、ログイン・ログアウト。
* **【ユニーク要件】隠しボタンによるログイン:**
    * 一般公開HP上の特定の場所（隠しボタン）を押すことで、管理機能のログインページに遷移する。
* **権限管理:** 「管理者」と「一般メンバー」の役割（ロール）を設定し、操作できる機能を制御する。

---

## 4. データベース設計（Firestore）
上記の機能を実現するため、以下のデータ構造（コレクション設計）を採用する。

* `users / {userId}`
    * (ユーザー情報)
* `teams / {teamId}`
    * (チームの基本情報)
* `teamMembers / {memberId}`
    * (ユーザーとチームの紐付け、権限 `role` を管理)

---
* `teams / {teamId} / **players** / {playerId}`
    * (選手名簿)
* `teams / {teamId} / **schedules** / {scheduleId}`
    * (スケジュール情報)
* `teams / {teamId} / **articles** / {articleId}`
    * (HP用の記事、`linkedGameId` で試合と連携)
* `teams / {teamId} / **stats** / {statsId}`
    * (自動集計済みの「成績」を保存する場所)

---
* `teams / {teamId} / **games** / {gameId}`
    * (試合ごとの情報。対戦相手、日付、`videoUrl`、`stamen`、`finalScore` などを保存)
    * **サブコレクション:** `... / games / {gameId} / **plays** / {playId}`
        * (「一球ごと」または「一打席ごと」の入力データを時系列で保存)

---
* **自動集計の仕組み:**
    試合終了時、**Cloud Functions (Node.js)** が起動。`.../plays` サブコレクションを読み込み、成績を集計して `games/{gameId}` の `finalScore` や `stats/{statsId}` のデータを更新する。