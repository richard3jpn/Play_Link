# ⚾ 野球クラブ用 統合管理アプリ「プレイリンク」要件定義書

## 1. プロジェクト概要

### 1.1. プロジェクト名
プレイリンク (Play Link)

### 1.2. プロジェクトの目的
アマチュア野球チームの運営において、これまで別々のツールで行われていた「広報活動（HP）」と「チーム内部運営（選手・スコア管理）」を、本アプリ一つでシームレスに完結させる。
これにより、チーム運営の効率化、情報発信の強化、およびメンバーのエンゲージメント向上を実現する。

### 1.3. アプリのコアコンセプト
* **オールインワン:** 外部公開用のHPから、試合の一球ごとの記録、詳細な成績分析まで、チーム運営に必要な全機能を統合する。
* **直感的なUI/UX:** 試合現場での使用を想定し、スマートフォンで直感的に操作できるUI（特に「作戦ボード風スタメン登録」や「スコア入力」）を提供する。
* **シームレスな体験:** 一般訪問者が見る「HP」と、チーム関係者が見る「管理画面」を一つのサービスとして提供し、独自の導線（隠しボタン）で接続する。

---

## 2. 採用技術スタック
開発の堅牢性、スケーラビリティ、およびFirebaseプラットフォームの利便性を両立するため、以下の構成を採用する。

* **フロントエンド:** **React**
* **データベース:** **PostgreSQL**
* **バックエンド (API):** **Firebase Data Connect**
    * PostgreSQLのテーブル定義（GraphQLスキーマ）に基づき、安全なデータアクセスAPIを自動生成・管理する。
* **バックエンド (ロジック):** **Node.js (Firebase Cloud Functions)**
    * 認証連携、成績の自動集計バッチ、リアルタイム処理など、Data Connectが担当しない複雑なビジネスロジックを実行する。
* **認証・管理:** Firebase Authentication, Firebase CLI, **Firebase Emulators（ローカル開発用）**

---

## 3. 機能要件（全機能）

### ① 広報（HP）機能（一般公開エリア）
* **トップページ:** お知らせ、最新記事、次回の試合予定、最新の試合結果のサマリーを表示。
* **記事（ブログ）機能:**
    * 管理者が記事（テキスト・画像）を作成・編集・削除できる。
    * 記事作成時に、「試合結果」のデータを連携し、スコアボードを記事内に挿入できる。
* **試合結果（アーカイブ）:** 過去の試合結果（スコア、対戦相手）を一覧表示し、詳細（ボックススコア）も閲覧できる。
* **チーム紹介:** チームの理念や歴史などを掲載する静的なページ。
* **メンバー紹介:** 選手やスタッフの公開用プロフィール（写真、名前、ポジションなど）を表示。

### ② チーム運営（管理）機能（要ログインエリア）
* **ダッシュボード:** ログイン後のホーム画面。次の予定、お知らせなどを集約。
* **スケジュール管理:** 練習、試合、イベントの予定をカレンダー形式で登録・管理。
* **選手管理（選手名簿）:** 選手の詳細情報（背番号、ポジション、連絡先など）を登録・管理。
* **スコアブック（試合入力）機能:**
    * **スターティングメンバー登録:**
        * 試合前に、**全選手一覧**から選手を**ドラッグ＆ドロップ**で、**作戦ボード風のUI**（ポジション枠、ベンチ枠）に配置してスタメンと打順を決定する。
    * **一球ごとの入力:** 試合中、投球（ボール、ストライク等）や打撃結果（ヒット、アウト等）を直感的に入力する。
* **スコア・成績管理（自動集計）:**
    * 入力されたスコアを基に、個人成績（打率、防御率など）とチーム成績を**自動で集計**し、表示する。
    * 過去の試合のボックススコアを閲覧できる。
* **試合アーカイブ（動画管理）:** 試合記録に、YouTubeの限定公開URLなどの動画リンクを紐づけて管理できる。
* **チーム内連絡:** メンバーへのお知らせ一斉送信機能。

### ③ 共通・基盤機能
* **チーム管理:** チームのアカウントを作成し、基本情報（チーム名、ロゴ）を設定する。
* **認証機能:** メンバーの招待、アカウント登録、ログイン・ログアウト。
* **【ユニーク要件】隠しボタンによるログイン:**
    * 一般公開HP上の特定の場所（隠しボタン）を押すことで、管理機能のログインページに遷移する。
* **権限管理:** 「管理者」と「一般メンバー」の役割（ロール）を設定し、操作できる機能を制御する。

---

## 4. データベース設計 (PostgreSQL)
Firebase Data Connect の基盤として、以下のテーブル構造を定義する。（※詳細は別途「テーブル定義書」に記載）

* **ユーザー管理:**
    * `users` (ユーザー情報)
    * `teams` (チーム情報)
    * `team_members` (ユーザーとチームの所属・権限を管理する中間テーブル)
* **チーム運営データ:**
    * `players` (選手名簿、`team_id`でチームに紐づく)
    * `schedules` (スケジュール、`team_id`でチームに紐づく)
    * `games` (試合情報、`team_id`でチームに紐づく)
    * `game_lineups` (試合のスタメン・ベンチ情報、`game_id`と`player_id`に紐づく)
    * `game_plays` (一球ごとの記録、`game_id`に紐づく)
* **集計・広報データ:**
    * `player_stats` (集計済みの選手成績、`player_id`と`season`に紐づく)
    * `articles` (HPの記事、`team_id`でチームに紐づく。`linked_game_id`で試合と連携)

---

## 5. 主要ロジック（自動集計）
* **トリガー:** 試合終了時（例：`games`テーブルの`status`が "final" に更新された時）。
* **実行:** **Cloud Functions (Node.js)** が起動。
* **処理:** 該当の`game_id`を持つ`game_plays`テーブルの全データを読み込み、集計。
* **結果:** `player_stats`テーブルの該当選手・シーズンの成績を更新（または新規作成）し、`games`テーブルの`home_score`, `away_score`を確定させる。

## 6. 開発環境（非機能要件）
* **ローカル開発:** **Firebase Emulators** を使用し、ローカルPC上でPostgreSQL (Data Connect) を含む完全なオフライン開発環境を構築する。
* **デプロイ:** ローカルで開発・テストが完了したコードとスキーマを、`firebase deploy`コマンドで一括して本番環境にデプロイする。